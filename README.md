# Postgres_2.0
<a id="contents"></a>
[Домашнее задание №1 (Первичная настройка ОС и PostgreSQL БД)](#1)

[Домашнее задание №2 (Коннектинг к PostgreSQL. Права пользователей)](#2)
<a id="1">
### Домашнее задание №1 (Первичная настройка ОС и PostgreSQL БД)
Конфигурация ВМ:
 - Ubuntu 20.04.6 LTS
 - 8 CPU
 - 32 ГБ оперативки
 - 250 ГБ ssd

Установлен Postgres 15.

Генерация данных:
`pgbench -i -s 6000 postgres`

### Тестируем на дефолтных настройках Postgres.

mode simple: `pgbench -c N -j 8 -T 1800 postgres`, где с - кол-во клиентов. Число имитируемых клиентов, то есть число одновременных сеансов базы данных.

| Метрики / Тест | 5 клиентов | 50 клиентов | 100 клиентов | 
| ----------- | ----------- | ----------- | ----------- |
| CPU    | 30-35% | 50-75% | 60-80% |
| ОЗУ    | 1.4 ГБ | 1.4 ГБ  | 1.4 ГБ |
| latency average    | 2.391 ms  | 10.897 ms  | 18.689 ms |
| tps    | 2091  | 4588   | 5350   |

mode extended: `pgbench -M extended -c N -j 8 -T 1800`, где с - кол-во клиентов. Число имитируемых клиентов, то есть число одновременных сеансов базы данных.

| Метрики / Тест | 5 клиентов | 50 клиентов | 100 клиентов | 
| ----------- | ----------- | ----------- | ----------- |
| CPU    | 25-30% | 60-80% | 70-85% |
| ОЗУ    | 1.4 ГБ | 1.4 ГБ  | 1.4 ГБ |
| latency average    | 2.256 ms  | 10.024 ms  | 22.463 ms |
| tps    | 2216  | 4988   | 4451  |

#### При дефолтных значених Postgres оперативка не привышала 1.4 ГБ. При увеличение кол-во клиентов увеличивались потребление CPU и кол-во tps. В последнем прогоне в mode extended кол-во tps просело.

Измениили настройки по умолчанию:
 - shared_buffers
 - work_mem
 - maintenance_work_mem
 - huge_pages
 - и другие

### Тестируем на измененных настройках Postgres.

mode simple: `pgbench -c N -j 8 -T 1800 postgres`

| Метрики / Тест | 5 клиентов | 50 клиентов | 100 клиентов | 
| ----------- | ----------- | ----------- | ----------- |
| CPU    | 30-40% | 75-82% | 88-92% |
| ОЗУ    | 1.64 ГБ | 2.6 ГБ  | 3.05 ГБ |
| latency average    | 2.717 ms  | 10.525 ms  | 20.729 ms |
| tps    | 1839  | 4750   | 5850   |

mode extended: `pgbench -M extended -c N -j 8 -T 1800 postgres`

| Метрики / Тест | 5 клиентов | 50 клиентов | 100 клиентов | 
| ----------- | ----------- | ----------- | ----------- |
| CPU    | 35-40% | 85-90% | 87-92% |
| ОЗУ    | 1.43 ГБ | 2.23 ГБ  | 2.77 ГБ |
| latency average    | 2.682 ms  | 10.632 ms  | 21.131 ms |
| tps    | 1864  | 4702   | 4685   |

</a>

[Оглавление](#contents)
